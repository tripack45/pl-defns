\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ctillst-lr}[\texttt{CTILLST} Definitions: Logical Relations]

\makeatletter

\DeclareDocumentCommand{\expose}{m m}{{{#1}{\,|}_{#2}}}
\DeclareDocumentCommand{\wp}{m m m}{{#1}^{\Abs(#2){#3}}}

\DeclareDocumentCommand{\propf}{o m}{%
\IfNoValueF{#1}{#1}\llbracket{#2}\rrbracket%
}

%% Generic LR definition
%% Arguments: Star [Proof] {Term} [Family] {Type}
%% Default: Type is in interpretation brackets, family proceeds brackets
%%          p : M \in F[[ A ]]
%% Starred: Type is alone, family indexes membership operator
%%          p : M \in_F A 
%% Proof argument is optional
\DeclareDocumentCommand{\InLR@}{m m m m m}{%
\IfNoValueF{#2}{{#2}\mathbin{:}}{#3}%
\IfBooleanTF{#1}%
{\IfNoValueTF{#4}{\in}{\in_{#4}}{#5}}%
{\in \IfNoValueF{#4}{#4}\llbracket{#5}\rrbracket}%
}

%% This one is defined just for the temporal calculus
\DeclareDocumentCommand{\InTLR@}{m m m m m m}{\InLR@{#1}{#2}{#3}{#4}{#5}\mathbin{@}{#6}}

%% Actually mark arguments optional
\DeclareDocumentCommand{\InLR}{s o m d<> m}{\InLR@{#1}{#2}{#3}{#4}{#5}}
\DeclareDocumentCommand{\InTLR}{s o m d<> m m}{\InTLR@{#1}{#2}{#3}{#4}{#5}{#6}}

\DeclareDocumentCommand{\InL}{s o m d<> m m}{\InTLR@{#1}{#2}{#3}{\calL}{#5}{#6}}
\DeclareDocumentCommand{\InLS}{s o m d<> m m}{\InTLR@{#1}{#2}{#3}{\calL^{\star}}{#5}{#6}}
\DeclareDocumentCommand{\InLAny}{s o m d<> m m}{\InTLR@{#1}{#2}{#3}{\calL^{(\star)}}{#5}{#6}}
\DeclareDocumentCommand{\InV}{s o m d<> m m}{\InTLR@{#1}{#2}{#3}{\calV}{#5}{#6}}
\DeclareDocumentCommand{\InVS}{s o m d<> m m}{\InTLR@{#1}{#2}{#3}{\calV^{\star}}{#5}{#6}}
\DeclareDocumentCommand{\InVAny}{s o m d<> m m}{\InTLR@{#1}{#2}{#3}{\calV^{(\star)}}{#5}{#6}}

% Proof irrelevant 

\DeclareDocumentCommand{\LInt}{m m}{\mathcal{L}\llbracket{{#1}}\rrbracket\mathrel{@}{#2}}
\DeclareDocumentCommand{\VInt}{m m}{\mathcal{V}\llbracket{{#1}}\rrbracket\mathrel{@}{#2}}
\DeclareDocumentCommand{\LSInt}{m m}{\mathcal{L}^\star\llbracket{{#1}}\rrbracket\mathrel{@}{#2}}
\DeclareDocumentCommand{\VSInt}{m m}{\mathcal{V}^\star\llbracket{{#1}}\rrbracket\mathrel{@}{#2}}

\DeclareDocumentCommand{\LAnyInt}{m m}{\mathcal{L}^{(\star)}\llbracket{{#1}\rrbracket}{\mathrel{@}{#2}}}
\DeclareDocumentCommand{\VAnyInt}{m m}{\mathcal{V}^{(\star)}\llbracket{{#1}\rrbracket}{\mathrel{@}{#2}}}

\DeclareDocumentCommand{\StarOpt}{m}{\ensuremath{{\left({#1}\right)}^{(\star)}}}

\DeclareDocumentCommand{\sementails}{m}{\gg{#1}}
\DeclareDocumentCommand{\SemIsOf}{m m}{{#1}\in{#2}}

% Proof relevant 
\DeclareDocumentCommand{\WLInt}{m m m m m}{{#1} \vDash {#2} \in_{#2} \mathcal{L}\llbracket{{#3}\mathrel{@}{#4}}\rrbracket}
\DeclareDocumentCommand{\WLSInt}{m m m m m}{{#1} \vDash {#2} \in_{#3} \mathcal{L}^\star\llbracket{{#3}\mathrel{@}{#4}}\rrbracket}
\DeclareDocumentCommand{\WLSIntD}{m m m m}{{#1}\vDash {#2} \in \mathcal{L}^\star\llbracket{{#3}\mathrel{@}{#4}}\rrbracket}

%\DeclareDocumentCommand{\gl}{m m}{{#1} \vDash {#2}}
\DeclareDocumentCommand{\gl}{m m}{\langle{#1}, {#2}\rangle}

% Functional Logical Relation
\NewDocumentCommand{\InVal}{s o m O{} m}{\InLR@{#1}{#2}{#3}{\calV_{#4}\,}{#5}}
\NewDocumentCommand{\InComp}{s o m O{} m m}{\InLR@{#1}{#2}{#3}{\calC_{#4}^{#5}\,}{#6}}

\NewDocumentCommand{\interpComp}{o m m m}{\InComp{#2}{#3}{#4}\IfValueT{#1}{_{#1}}}
\NewDocumentCommand{\interpVal}{o m m}{\InVal{#2}{#3}\IfValueT{#1}{_{#1}}}
\NewDocumentCommand{\interpValStore}{m m}{\InLR{#1}<\calV^{\Sigma}>{#2}}

% \NewDocumentCommand{\inCmd}{m}{\ \widetilde{\jin}_{#1} \ }
% \NewDocumentCommand{\interpCmd}{o m m m}{#2 \mathrel{\widetilde{\jin}}_{#3} \Interp{#4} \IfValueT{#1}{_{#1}}}
% \NewDocumentCommand{\interpVal}{o m m}{#2 \in \Interp{#3}\IfValueT{#1}{_{#1}}}
% \NewDocumentCommand{\interpValStore}{m m}{#1 \in \Interp{#2}^*}
\makeatother